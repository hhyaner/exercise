<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form method="post">
        <input type="text" name="username" value="" id="myText"/>
        <input type="button" value="Echo Username" onclick="alert(username.value)" />
    </form>
    <div class="myDiv" id="myDiv">
        <p>11</p>
        <p>21</p>
        <p>31</p>
        <p>41</p>
        <p>51</p>
        <p>61</p>
        <p>71</p>
        <p>81</p>
        <p>91</p>
        <p>101</p>
        <p>111</p>
        <p>121</p>
        <p>131</p>
        <p>141</p>
        <p>151</p>
        <p>161</p>
        <p>171</p>
        <p>181</p>
        <p>191</p>
        <p>201</p>
        <p>211</p>
        <p>221</p>
        <p>231</p>
        <p>241</p>
        <p>251</p>
        <p>261</p>
        <p>271</p>
        <p>281</p>
        <p>291</p>
        <p>301</p>
        <p>311</p>
        <p>321</p>
        <p>331</p>
        <p>341</p>
        <p>351</p>
        <p>361</p>
        <p>371</p>
        <p>381</p>
        <p>391</p>
        <p>401</p>
        <p>411</p>
        <p>421</p>
        <p>431</p>
        <p>441</p>
        <p>451</p>
        <p>461</p>
        <p>471</p>
        <p>481</p>
        <p>491</p>
        <p>501</p>
        <p>511</p>
        <p>521</p>
        <p>531</p>
        <p>541</p>
        <p>551</p>
        <p>561</p>
        <p>571</p>
        <p>581</p>
        <p>591</p>
        <p>601</p>
        <p>611</p>
        <p>621</p>
        <p>631</p>
        <p>641</p>
        <p>651</p>
        <p>661</p>
        <p>671</p>
        <p>681</p>
        <p>691</p>
        <p>701</p>
        <p>711</p>
        <p>721</p>
        <p>731</p>
        <p>741</p>
        <p>751</p>
        <p>761</p>
        <p>771</p>
        <p>781</p>
        <p>791</p>
        <p>801</p>
        <p>811</p>
        <p>821</p>
        <p>831</p>
        <p>841</p>
        <p>851</p>
        <p>861</p>
        <p>871</p>
        <p>881</p>
        <p>891</p>
        <p>901</p>
        <p>911</p>
        <p>921</p>
        <p>931</p>
        <p>941</p>
        <p>951</p>
        <p>961</p>
        <p>971</p>
        <p>981</p>
        <p>991</p>
        <p>1001</p>
    </div>
    <input type="button" value="My Button" id="myBtn" />
    <input type="button" value="My Button cancel" id="myBtn2" />
    <input type="button" value="Click Me" onclick="showMessage()" />
    <input type="button" value="Click Me 2" onclick="alert(event.type)" />
    <input type="button" value="Click Me 3" onclick="alert(this.value)" />
    <input type="button" value="Click Me 4" onclick="alert(value)" />
    <script type="text/javascript" src="../util/EventUtil.js"></script>
    <script type="text/javascript">
        var isSupported = document.implementation.hasFeature('UIEvent', '3.0');
        console.log('isSupported UIEvent', isSupported);

        var isSupportedFocusEvent = document.implementation.hasFeature('FocusEvent', '3.0');
        console.log('isSupported FocusEvent', isSupportedFocusEvent);

        var isSupportedMouseEvent = document.implementation.hasFeature('MouseEvents', '2.0');
        console.log('isSupported MouseEvents', isSupportedMouseEvent);

        var isSupportedMouseEvent3 = document.implementation.hasFeature('MouseEvent', '3.0');
        console.log('isSupportedMouseEvent3', isSupportedMouseEvent3);

        EventUtil.addHandler(window, 'load', function(event) {
            var image = new Image();
            EventUtil.addHandler(image, 'load', function(event) {
                // event = EventUtil.getEvent(event);
                // alert(EventUtil.getTarget(event).src);
                console.log('Image loaded');
            });
            // document.body.appendChild(image);
            image.src = 'http://imge.kugou.com/mvhdpic/400/20170901/20170901144620482755.jpg';

            var script = document.createElement('script');
            EventUtil.addHandler(script, 'load', function(event) {
                console.log('Scripts loaded');
            });
            script.src = 'example.js';
            document.body.appendChild(script);
            console.log('loaded');

            var link = document.createElement('link');
            link.type = 'text/css';
            link.rel = 'stylesheet';
            EventUtil.addHandler(link, 'load', function(event) {
                console.log('css loaed');
            });
            link.href = 'example.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        });

        EventUtil.addHandler(window, 'unload', function(event) {
            // alert('unloaded');
            
        });

        EventUtil.addHandler(window, 'resize', function(event) {
            // console.log('resized');
        });

        EventUtil.addHandler(window, 'scroll', function(event) {
            // if (document.compatMode == 'CSS1Compat') {
            //     console.log('CSS1Compat', document.documentElement.scrollTop, document.body.scrollTop);
            // }
            // else {
            //     console.log('here', document.body.scrollTop);
            // }
        });

        var textbox = document.getElementById('myText');
        EventUtil.addHandler(textbox, 'keyup', function(event) {
            event = EventUtil.getEvent(event);

            console.log('keyup keycode:', EventUtil.getCharCode(event));
        })

        // EventUtil.addHandler(textbox, 'keypress', function(event) {
        //     event = EventUtil.getEvent(event);
        //     var loc = event.location || event.keyLocation;

        //     console.log('keypress location:', loc);
        // });

        EventUtil.addHandler(textbox, 'textInput', function(event) {
            event = EventUtil.getEvent(event);

            console.log('textInput event:', event.data);
        });

        var div = document.getElementById('myDiv');
        EventUtil.addHandler(div, 'click', function(event) {
            event = EventUtil.getEvent(event);

            // clientX, client 代表的是视口的信息
            console.log('Client coordinates: ' + event.clientX + ', ' + event.clientY);
            

            var pageX = event.pageX;
            var pageY = event.pageY;

            if (pageX === undefined) {
                pageX = event.clientX + (document.body.scrollLeft || document.documentElement.scrollLeft);
            }

            if (pageY === undefined) {
                pageY = event.clientY + (document.body.scrollTop || document.documentElement.scrollTop);
            }   
            console.log('Page coordinates:' + event.pageX + ', ' + event.pageY);
            console.log('Screen coordinates:' + event.screenX + ', ' + event.screenY);

            var keys = new Array();

            if (event.shiftKey) {
                keys.push('shift');
            }

            if (event.ctrlKey) {
                keys.push('ctrl');
            }

            if (event.altKey) {
                keys.push('alt');
            }

            if (event.metaKey) {
                keys.push('meta');
            }

            console.log("Keys:" + keys.join(','));
        });

        EventUtil.addHandler(div, 'mouseout', function(event) {
            event = EventUtil.getEvent(event);
            var target = EventUtil.getTarget(event);
            var relatedTarget = EventUtil.getRelatedTarget(event);
            console.log('Moused out of ' + target.tagName + ' to ' + relatedTarget.tagName);
        });

        EventUtil.addHandler(div, 'mousedown', function(event) {
            event = EventUtil.getEvent(event);
            console.log('mousedonw button', EventUtil.getButton(event));
        });

        EventUtil.addHandler(window, 'mousewheel', function(event) {
            event = EventUtil.getEvent(event);
            console.log('mousewheel', event.wheelDelta);
        })

        var btn = document.getElementById('myBtn');
        // btn.onclick = function() {
            //     alert(this.id);
            // };
        var handler = function() {
            alert(this === window);
        }
        
        var sayHello = function() {
            alert('Hello world!');
        }

        EventUtil.addHandler(btn, 'click', handler);
        EventUtil.addHandler(btn, 'click', sayHello);

        var btn2 = document.getElementById('myBtn2');
        btn2.onclick = function () {
            // btn.onclick = null;
            // alert('cancel mybtn1 click event');
            EventUtil.removeHandler(btn, 'click', handler);
        };

        function showMessage() {
            alert('Hello world!');
        }

    </script>
</body>
</html>